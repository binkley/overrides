<eg-tag>
    <p class="ui sub header">Hello, world!</p>
    <ul>
        <li each={ examples } value={ resourceId }>
            { name }{ null === overrideId ? '' : '*' }
            <a href="{ _links.self.href }">View</a>
        </li>
    </ul>
    <form onsubmit={ addExample } class="ui form">
        <h2>Create an example</h2>
        <p>Examples are complete, unique entries in their "direct" form</p>
        <fieldset>
            <legend>Create an example</legend>
            <label>Name:
                <input type="text" id="addExampleName" ref="addExampleName"
                        required/>
            </label>
            <button class="ui button">Create</button>
        </fieldset>
    </form>
    <form onsubmit={ addOverride } class="ui form">
        <h2>Create an override</h2>
        <p>Overrides temporarily an existing example</p>
        <fieldset>
            <legend>Create an override</legend>
            <label>Example ID:
                <select id="addOverrideExampleId"
                        ref="addOverrideExampleId" required
                        class="ui selection flex dropdown">
                    <option each={ examplesWithoutOverrides() }
                            value={ resourceId }>
                        { resourceId } - { name }
                    </option>
                </select>
            </label>
            <br>
            <label>Name:
                <input type="text" id="addOverrideName"
                        ref="addOverrideName" required/>
            </label>
            <button class="ui button">Create</button>
        </fieldset>
    </form>
    <form onsubmit={ delOverride } class="ui form">
        <h2>Undo an override</h2>
        <p>Undoes the temporarily override of an existing example</p>
        <fieldset>
            <legend>Undo an override</legend>
            <label>Example ID:
                <select id="delOverrideExampleId"
                        ref="delOverrideExampleId" required
                        class="ui selection flex dropdown">
                    <option each={ examplesWithOverrides() }
                            value={ overrideId }>
                        { overrideId } - { name }
                    </option>
                </select>
            </label>
            <button class="ui button">Undo</button>
        </fieldset>
    </form>
    <script>
      var self = this
      self.examples = []

      updateExamples()
      {
        fetchival('/examples')
          .get()
          .then(function (json) {
            self.examples = json._embedded.examples
            self.update()
          })
      }

      addExample(e)
      {
        e.preventDefault()
        fetchival('/directs')
          .post({
            name: self.refs.addExampleName.value
          })
          .then(function () {
              self.updateExamples()
            }
          )
        return false
      }

      addOverride(e)
      {
        e.preventDefault()
        fetchival('/overrides')
          .post({
            exampleId: self.refs.addOverrideExampleId.value,
            name: self.refs.addOverrideName.value
          })
          .then(function () {
              self.updateExamples()
            }
          )
        return false
      }

      delOverride(e)
      {
        e.preventDefault()
        fetchival('/overrides/' + self.refs.delOverrideExampleId.value)
          .delete()
          .then(function () {
              self.updateExamples()
            }
          )
        return false
      }

      examplesWithoutOverrides()
      {
        return self.examples.filter(function (e) {
          return null === e.overrideId
        })
      }

      examplesWithOverrides()
      {
        return self.examples.filter(function (e) {
          return null !== e.overrideId
        })
      }

      self.on('mount', function () {
        self.updateExamples()
      })
    </script>
</eg-tag>
